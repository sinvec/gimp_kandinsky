# Плагин Kandinsky для GIMP
Плагин который позволяет использовать российскую модель Kandinsky прямо в GIMP!
## Особенности

- Написан на Python c применением фраемворка Flask и библиотеки GTK 
- Позволяет пользователю вводить прямой и негативный промпты, а также можно задавать настройки генерации (итерации внутренних пайплайнов и CGS параметры)
- Можно работать как с RGB, так и с RGBA изображениями
- Есть возможность генерации сразу нескольких изображений
- Нет ограничений на соотношения сторон и максимальные размеры исходного изображения

## Структура проекта

- `client/Kandinsky.py` Клиентская часть плагина, в которой описаны интерфейс и логика работы с сервером
- `client/KandinskyIcon.png` Иконка, которую использует клиентская часть для интерфейса
- `server/ModelProcess.py` Вспомогательный процесс сервера, в котором развёртывается экземпляр модели и происходит инференс
- `server/ModifiedKandinskyV22Inpaint.py` Модификация основного класса `Kandinsky2_2`, которая позволяет фиксировать прогресс инференса вовне
- `server/main.py` Основной процесс сервера, является посредником между клиентом и моделью
- `setup_client.py` Скрипт, который устанавливает клиентскую часть в редактор

## Установка

Перед началом установки плагина на серверной машине должна быть установлена корректная версия библиотеки PyTorch, совместимая с драйвером имеющейся видеокарты Nvidia.

Если с PyTorch всё ок, то первым делом клонируем проект

```sh
git clone https://github.com/sinvec/gimp_kandinsky
```

Переходим в папку проекта

```sh
cd gimp_kandinsky
```

Устанавливаем все зависиомсти, перечисленные в файле `pyproject.toml`

```sh
python -m pip install .
```

И отдельно устанавливаем клиентскую часть плагина

```sh
python setup_client.py
```
После этого можно будет запускать плагин
## Запуск плагина

Запуск **сервера** осуществляем с помощью консольной утилиты веб-сервера Waitress

```sh
waitress-serve ––call server.main:create_app
```

Запуск **клиента** производим уже непосредственно в самом редакторе через соответсвующий элемент меню

## Порядок работы

- Открываем в редакторе нужное изображение
- Поднимаем нужный слой на первое место в иерархии слоев проекта
- Создаем любым доступным способом выделение
- Вызываем плагин либо через строку меню, либо через контекстное меню. Элемент меню: `Kandinsky` -> `inpaint`
- В открывшемся окне вводим промпты и задаем параметры генерации
- Нажимаем на большую конпку с двумя зелёными звездами
- Ждем инференс
- По итогу инференса получаем набор новых слоев, выбираем нужный и удаляем остальные

## Лицензия

MIT

**Free Software, Hell Yeah!**
